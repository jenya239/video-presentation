<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cabinet Assembly Animation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
        }
        
        #canvas {
            display: block;
        }
        
        .info-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 300px;
            backdrop-filter: blur(10px);
        }
        
        .info-panel h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
            color: #4fc3f7;
        }
        
        .stage-info {
            margin: 10px 0;
            padding: 10px;
            background: rgba(79, 195, 247, 0.2);
            border-radius: 5px;
        }
        
        .material-info {
            margin: 5px 0;
            font-size: 12px;
            color: #aaa;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4fc3f7, #29b6f6);
            width: 0%;
            transition: width 0.3s;
        }
        
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
        }
        
        .controls button {
            background: #4fc3f7;
            border: none;
            color: white;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .controls button:hover {
            background: #29b6f6;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="info-panel">
        <h2>Cabinet Assembly</h2>
        <div class="stage-info">
            <div id="stage-name">Stage: Bottom Panel</div>
            <div id="materials-used">Parts: 0 / 10</div>
            <div class="material-info" id="material-details">
                Plywood board: 1000×500×18mm
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
    </div>
    
    <div class="controls">
        <button onclick="changeSpeed(-1)">◄ Slower</button>
        <button onclick="togglePause()">⏸ Pause</button>
        <button onclick="changeSpeed(1)">Faster ►</button>
        <button onclick="resetConstruction()">↻ Reset</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // Sky blue
        scene.fog = new THREE.Fog(0x87ceeb, 50, 200);
        
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        
        camera.position.set(2, 1.5, 2);
        camera.lookAt(0, 1, 0);
        
        // OrbitControls for mouse interaction
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 1;
        controls.maxDistance = 10;
        controls.target.set(0, 1, 0);
        controls.update();
        
        // Lighting
        const sunLight = new THREE.DirectionalLight(0xffffff, 1);
        sunLight.position.set(30, 50, 20);
        sunLight.castShadow = true;
        sunLight.shadow.camera.left = -20;
        sunLight.shadow.camera.right = 20;
        sunLight.shadow.camera.top = 20;
        sunLight.shadow.camera.bottom = -20;
        sunLight.shadow.mapSize.width = 2048;
        sunLight.shadow.mapSize.height = 2048;
        scene.add(sunLight);
        
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        
        // Ground
        const groundGeometry = new THREE.PlaneGeometry(100, 100);
        const groundMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x8b7355,
            roughness: 0.9
        });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);
        
        // Cabinet dimensions
        const cabinetWidth = 1.0;    // 1 meter
        const cabinetHeight = 2.0;   // 2 meters
        const cabinetDepth = 0.5;    // 0.5 meter
        const boardThickness = 0.018; // 18mm boards
        const plywoodThickness = 0.006; // 6mm plywood
        
        const woodColor = 0xdaa520;  // Golden wood
        const plywoodColor = 0xd2b48c; // Lighter wood
        
        // Construction elements
        const parts = [];
        let currentStage = 0;
        let paused = false;
        let speed = 1;
        
        // Assembly stages
        const stages = [
            { name: 'Bottom Panel', desc: 'Board 1000×500×18mm', build: () => addBottom() },
            { name: 'Left Side', desc: 'Board 2000×500×18mm', build: () => addLeftSide() },
            { name: 'Right Side', desc: 'Board 2000×500×18mm', build: () => addRightSide() },
            { name: 'Top Panel', desc: 'Board 1000×500×18mm', build: () => addTop() },
            { name: 'Shelf 1', desc: 'Board 964×482×18mm', build: () => addShelf(1) },
            { name: 'Shelf 2', desc: 'Board 964×482×18mm', build: () => addShelf(2) },
            { name: 'Back Panel', desc: 'Plywood 1000×2000×6mm', build: () => addBack() },
            { name: 'Left Door', desc: 'Board 490×1964×18mm', build: () => addDoor('left') },
            { name: 'Right Door', desc: 'Board 490×1964×18mm', build: () => addDoor('right') }
        ];
        
        const totalStages = stages.length;
        
        function createPart(width, height, depth, x, y, z, color, rotX = 0, rotY = 0) {
            const geometry = new THREE.BoxGeometry(width, height, depth);
            const material = new THREE.MeshStandardMaterial({ 
                color: color,
                roughness: 0.7,
                metalness: 0.1
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.userData.targetPos = { x, y, z };
            mesh.userData.targetRot = { x: rotX, y: rotY };
            mesh.rotation.x = rotX;
            mesh.rotation.y = rotY;
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            
            // Start position: above and slightly away
            mesh.position.set(x, y + 2, z - 1);
            mesh.userData.progress = 0;
            
            scene.add(mesh);
            parts.push(mesh);
            return mesh;
        }
        
        // Cabinet assembly functions
        function addBottom() {
            // Bottom panel: 1000mm wide x 500mm deep x 18mm thick
            // Lies flat on the ground
            createPart(cabinetWidth, boardThickness, cabinetDepth, 
                      0, boardThickness/2, 0, woodColor);
        }
        
        function addLeftSide() {
            // Left side: 2000mm tall x 500mm deep x 18mm thick
            // Stands vertically on the left
            const x = -cabinetWidth/2 + boardThickness/2;
            const y = cabinetHeight/2 + boardThickness;
            createPart(boardThickness, cabinetHeight, cabinetDepth,
                      x, y, 0, woodColor);
        }
        
        function addRightSide() {
            // Right side: 2000mm tall x 500mm deep x 18mm thick
            // Stands vertically on the right
            const x = cabinetWidth/2 - boardThickness/2;
            const y = cabinetHeight/2 + boardThickness;
            createPart(boardThickness, cabinetHeight, cabinetDepth,
                      x, y, 0, woodColor);
        }
        
        function addTop() {
            // Top panel: 1000mm wide x 500mm deep x 18mm thick
            // Lies flat on top
            const y = cabinetHeight + boardThickness + boardThickness/2;
            createPart(cabinetWidth, boardThickness, cabinetDepth,
                      0, y, 0, woodColor);
        }
        
        function addShelf(num) {
            // Shelf: fits inside between the sides
            // 964mm wide (1000 - 2×18) x 482mm deep (500 - 18) x 18mm thick
            const innerWidth = cabinetWidth - 2 * boardThickness;
            const innerDepth = cabinetDepth - boardThickness;
            const y = boardThickness + (cabinetHeight / 3) * num;
            createPart(innerWidth, boardThickness, innerDepth,
                      0, y, boardThickness/2, woodColor);
        }
        
        function addBack() {
            // Back panel: 1000mm wide x 2000mm tall x 6mm plywood
            // Vertical panel at the back
            const z = cabinetDepth/2 - plywoodThickness/2;
            const y = cabinetHeight/2 + boardThickness;
            createPart(cabinetWidth, cabinetHeight, plywoodThickness,
                      0, y, z, plywoodColor);
        }
        
        function addDoor(side) {
            // Door: 490mm wide (1000/2 - 10 gap) x 1964mm tall (2000 - 2×18) x 18mm thick
            const doorWidth = cabinetWidth/2 - 0.01;
            const doorHeight = cabinetHeight - 2 * boardThickness;
            const x = side === 'left' ? -cabinetWidth/4 : cabinetWidth/4;
            const y = cabinetHeight/2 + boardThickness;
            const z = -cabinetDepth/2 - boardThickness/2;
            createPart(doorWidth, doorHeight, boardThickness,
                      x, y, z, woodColor);
        }
        
        // Animation
        let time = 0;
        const stageDuration = 60; // frames per stage
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (!paused) {
                time += 0.016 * speed;
                
                // Add next stage when ready
                if (currentStage < stages.length && 
                    (currentStage === 0 || parts.length > 0 && parts[parts.length - 1].userData.progress >= 0.8)) {
                    stages[currentStage].build();
                    currentStage++;
                    
                    // Update UI
                    if (currentStage <= stages.length) {
                        const stageIndex = Math.min(currentStage, stages.length - 1);
                        document.getElementById('stage-name').textContent = `Stage: ${stages[stageIndex].name}`;
                        document.getElementById('material-details').textContent = stages[stageIndex].desc;
                        document.getElementById('materials-used').textContent = `Parts: ${parts.length} / ${totalStages}`;
                        const progress = (currentStage / totalStages) * 100;
                        document.getElementById('progress').style.width = progress + '%';
                    }
                }
                
                // Animate parts moving to position
                parts.forEach((part) => {
                    if (part.userData.progress < 1) {
                        part.userData.progress += 0.02 * speed;
                        const t = Math.min(part.userData.progress, 1);
                        const eased = t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
                        
                        part.position.x = part.position.x + (part.userData.targetPos.x - part.position.x) * eased * 0.1;
                        part.position.y = part.position.y + (part.userData.targetPos.y - part.position.y) * eased * 0.1;
                        part.position.z = part.position.z + (part.userData.targetPos.z - part.position.z) * eased * 0.1;
                    }
                });
            }
            
            // Update controls
            controls.update();
            
            renderer.render(scene, camera);
        }
        
        function togglePause() {
            paused = !paused;
            document.querySelector('.controls button:nth-child(2)').textContent = paused ? '▶ Play' : '⏸ Pause';
        }
        
        function changeSpeed(delta) {
            speed = Math.max(0.5, Math.min(5, speed + delta * 0.5));
        }
        
        function resetConstruction() {
            parts.forEach(el => scene.remove(el));
            parts.length = 0;
            currentStage = 0;
            time = 0;
            document.getElementById('progress').style.width = '0%';
        }
        
        // Window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Start assembly
        animate();
    </script>
</body>
</html>

